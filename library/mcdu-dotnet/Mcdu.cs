// Copyright © 2025 onwards, Andrew Whewell
// All rights reserved.
//
// Redistribution and use of this software in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
//    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
//    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
//    * Neither the name of the author nor the names of the program's contributors may be used to endorse or promote products derived from this software without specific prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OF THE SOFTWARE BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

using System;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading;
using System.Threading.Tasks;
using HidSharp;
using McduDotNet.WinWingMcdu;

namespace McduDotNet
{
    /// <summary>
    /// The internal representation of an MCDU.
    /// </summary>
    class Mcdu : IMcdu
    {
        private readonly int _ProcessingPauseMilliseconds = 40;
        private readonly object _OutputLock = new Object();
        private HidDevice _HidDevice;
        private HidStream _HidStream;
        private readonly byte[] _DisplayPacket = new byte[64];
        private readonly char[] _DisplayCharacterBuffer = new char[1];
        private int _DisplayPacketOffset = 0;
        private string _DisplayDuplicateCheckString;
        private CancellationTokenSource _InputLoopCancellationTokenSource;
        private Task _InputLoopTask;
        private readonly InputReport01 _InputReport01_Previous = new InputReport01();
        private readonly InputReport01 _InputReport01_Current = new InputReport01();
        private (UInt64, UInt64, UInt64) _PreviousInputReport01Digest = (0,0,0);
        private Leds _PreviousLeds;

        /// <inheritdoc/>
        public ProductId ProductId { get; }

        /// <inheritdoc/>
        public Screen Screen { get; }

        /// <inheritdoc/>
        public Compositor Output { get; }

        /// <inheritdoc/>
        public Leds Leds { get; }

        /// <inheritdoc/>
        public event EventHandler<KeyEventArgs> KeyDown;

        /// <summary>
        /// Raises <see cref="KeyDown"/>. Doesn't bother creating args unless something is listening.
        /// </summary>
        /// <param name="createArgs"></param>
        protected virtual void OnKeyDown(Func<KeyEventArgs> createArgs)
        {
            if(KeyDown != null) {
                KeyDown?.Invoke(this, createArgs());
            }
        }

        /// <inheritdoc/>
        public event EventHandler<KeyEventArgs> KeyUp;

        /// <summary>
        /// Raises <see cref="KeyUp"/>. Doesn't bother creating args unless something is listening.
        /// </summary>
        /// <param name="createArgs"></param>
        protected virtual void OnKeyUp(Func<KeyEventArgs> createArgs)
        {
            if(KeyUp != null) {
                KeyUp?.Invoke(this, createArgs());
            }
        }

        /// <summary>
        /// Raised when a disconnection of the MCDU is detected.
        /// </summary>
        public event EventHandler Disconnected;

        /// <summary>
        /// Raises <see cref="Disconnected"/>.
        /// </summary>
        protected virtual void OnDisconnected() => Disconnected?.Invoke(this, EventArgs.Empty);

        /// <summary>
        /// Creates a new object.
        /// </summary>
        /// <param name="hidDevice"></param>
        /// <param name="productId"></param>
        public Mcdu(HidDevice hidDevice, ProductId productId)
        {
            _HidDevice = hidDevice;
            ProductId = productId;
            Leds = new Leds();
            Screen = new Screen();
            Output = new Compositor(Screen);
            HidSharp.DeviceList.Local.Changed += HidSharpDeviceList_Changed;
        }

        /// <inheritdoc/>
        ~Mcdu()
        {
            Dispose(false);
        }

        /// <inheritdoc/>
        public void Dispose()
        {
            Dispose(true);
            GC.SuppressFinalize(this);
        }

        protected virtual void Dispose(bool disposing)
        {
            if(disposing) {
                HidSharp.DeviceList.Local.Changed -= HidSharpDeviceList_Changed;

                _InputLoopCancellationTokenSource?.Cancel();
                _InputLoopTask?.Wait(5000);
                _InputLoopTask = null;

                if(_HidStream != null) {
                    _HidStream.Dispose();
                    _HidStream = null;
                }
            }
        }

        public void Initialise()
        {
            var maxOutputReportLength = _HidDevice.GetMaxOutputReportLength();
            if(maxOutputReportLength < 64) {
                throw new McduException(
                    $"HID device {_HidDevice} reported an invalid max output report length of {maxOutputReportLength}"
                );
            }
            if(!_HidDevice.TryOpen(out _HidStream)) {
                throw new McduException($"Could not open a stream to {_HidDevice}");
            }

            _InputLoopCancellationTokenSource = new CancellationTokenSource();
            _InputLoopTask = Task.Run(() => InputLoop(_InputLoopCancellationTokenSource.Token));

            UseMobiFlightInitialisationSequence();
            RefreshLeds();
        }

        /// <inheritdoc/>
        public void Cleanup()
        {
            Screen.Clear();
            Leds.TurnAllOn(false);
            Leds.Brightness = .5;
            RefreshDisplay();
            RefreshLeds();
        }

        private void UseMobiFlightInitialisationSequence()
        {
            var packets = new string[] {
                //"f000013832bb00001e0100005f633100000000000032bb0000180100005f6331000008000000340018000e00180032bb0000190100005f633100000e00000000",
                //"f0000238000000010005000000020000000000000032bb0000190100005f633100000e000000010006000000030000000000000032bb00001901000000000000",
                //"f00003385f633100000e0000000200000000ff040000000000000032bb0000190100005f633100000e000000020000a5ffff050000000000000032bb00000000",
                //"f00004380000190100005f633100000e0000000200ffffffff060000000000000032bb0000190100005f633100000e0000000200ffff00ff0700000000000000",
                //"f00005380000000032bb0000190100005f633100000e00000002003dff00ff080000000000000032bb0000190100005f633100000e0000000200ff6300000000",
                //"f0000638ffff090000000000000032bb0000190100005f633100000e00000002000000ffff0a0000000000000032bb0000190100005f633100000e0000000000",
                //"f00007380000020000ffffff0b0000000000000032bb0000190100005f633100000e0000000200425c61ff0c0000000000000032bb0000190100005f00000000",
                //"f0000838633100000e0000000200777777ff0d0000000000000032bb0000190100005f633100000e00000002005e7379ff0e0000000000000032bb0000000000",
                //"f000093800190100005f633100000e0000000300000000ff0f0000000000000032bb0000190100005f633100000e000000030000a5ffff100000000000000000",
                //"f0000a3800000032bb0000190100005f633100000e0000000300ffffffff110000000000000032bb0000190100005f633100000e0000000300ffff0000000000",
                //"f0000b38ff120000000000000032bb0000190100005f633100000e00000003003dff00ff130000000000000032bb0000190100005f633100000e000000000000",
                //"f0000c38000300ff63ffff140000000000000032bb0000190100005f633100000e00000003000000ffff150000000000000032bb0000190100005f6300000000",
                //"f0000d383100000e000000030000ffffff160000000000000032bb0000190100005f633100000e0000000300425c61ff170000000000000032bb000000000000",
                //"f0000e38190100005f633100000e0000000300777777ff180000000000000032bb0000190100005f633100000e00000003005e7379ff19000000000000000000",
                //"f0000f38000032bb0000190100005f633100000e0000000400000000001a0000000000000032bb0000190100005f633100000e00000004000100000000000000",
                //"f00010381b0000000000000032bb0000190100005f633100000e0000000400020000001c0000000000000032bb00001a0100005f633100000100000000000000",
                //"f00011120232bb00001c0100005f6331000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",


"f000 cd 2a 32bb000006010000be90060000190000000500000017001d005b00000074000000000000005529000000000000000000000000000000000000000000",
"f000 ce 3c 32bb000007010000be900600000c02000005000000000000000002000020000000000000000000000000000000000000000000000000000000000000",
"f000 cf 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 d0 3c 210000000000000000000000000038000038000038000038000038000038000038000038000038000038000038000038000038000038000038000038",
"f000 d1 3c 00000000000000000000007c00007c00007c00007c000000000000000000002200000000000000000000000001ef0001ef0001ef0001ef0001ef0001",
"f000 d2 3c ef0001c70001c70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 d3 3c 00002300000000000000000000000001ef0001ef0001ef0001ef0001ef0001ef000fffe00fffe001ef0001ef0001ef0001ef0001ef0001ef000fffe0",
"f000 d4 3c 0fffe00fffe001ef0001ef0001ef0001ef0001ef0001ef0000000000000000000024000000000000003800003800003800003fc003ffc007ffc00f38",
"f000 d5 3c 000f38000f38000f38000f38000f38000fb80007ffc003ffe00039e00039e00039e00039e00039e00039e00039e00fffc00fffc00ffe000038000038",
"f000 d6 3c 00003800 25000000 00 000000000000000007c0301fe0701cf0e01c70c03c71803c73801c77001ef6000fee00079c0000180000380000700000e7e000",
"f000 d7 12 cf32bb000005010000be9006000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 d8 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 65 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 62 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 d9 3c 32bb000007010000d4900600000c020000050000000002000000020000 f0 01 de 70 03 9c 78 03 1c 78 07 1c 78 0e 1c 70 1c 1e f0 1c 0f e0 38 01 00 00 00 00 00 00 00",
"f000 da 3c 0000 02 2600000000000000000000f00003fc0007fe00070e000f0f00070e00079e0007bc0003f80003e00007e0000ff0381e78383c3c383c3e78381f",
"f000 db 3c 70380ff03807f03c03e03e03f01f07f80fff7807fe1800400800000000000000000027000000000000000000000000007c00007c00007c0000780000",
"f000 dc 3c 380000380000380000380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 dd 3c 0000000000280000000000000000000000000000000007e0001fc0007e0000f80001e00003c00003c0000780000780000700000700000f00000f0000",
"f000 de 3c 0f000007000007000007800007800003c00003e00001f00000f800003f00000fe00001e02900000000000000000000000000000007c00007f800007e",
"f000 df 3c 00001f00000f800007800003c00001c00001e00001e00001e00000e00000e00001e00001e00001e00001e00003c00003c0000780000f00003e0000fc",
"f000 e0 3c 0007f0000780002a000000000000000000007800077b8007ff8000fe0000780007ffc007ffc000780000780001ff0007ff8003798000080000000000",
"f000 e1 3c 00000000000000000000000000000000000000000000000000000000000000000000000000002b000000000000000000000000000000000000000000",
"f000 e2 12 0032bb000005010000d49006000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 e3 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 66 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 63 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 e4 3c 32bb000007010000ea900600000c02000005000000000400000002000000000000000000000038000038000038000038000038000fffe00fffe00fff",
"f000 e5 3c e00038000038000038000038000038000038000000000000000000000000000000000000002c00000000000000000000000000000000000000000000",
"f000 e6 3c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003c00003c00003c0000",
"f000 e7 3c 3c00007c000078002d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffc00fffc0",
"f000 e8 3c 0fffc00000000000000000000000000000000000000000000000000000000000000000000000002e0000000000000000000000000000000000000000",
"f000 e9 3c 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007c00007c00007c00007c",
"f000 ea 3c 000000000000000000002f0000000000780000700000f00001e00001e00003c00003c0000780000780000f00000f00001e00001e00003c0000380000",
"f000 eb 3c 780000f00000f00001e00001e00003c00003c0000780000780000f00000f00001e00001e00003c00003000000000000000000000000000fe0003ff80",
"f000 ec 3c 07ffc00f83e00f01e00f03e00f07e00f07e00f0fe00f1fe00f3fe00f7de00ff9e00ff1e00fe1e00fc1e00f81e00f01e00f01e00f83e007ffc001ff00",
"f000 ed 12 0032bb000005010000eb9006000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 ee 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 67 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 64 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 ef 3c 32bb00000701000002910600000c020000050000000006000000020000100000000000000000000031000000000000000000000000007c00007c0000",
"f000 f0 3c fc0001fc0001bc00013c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c0003ffc003ffc003",
"f000 f1 3c ffc000000000000000000032000000000000000000000000007e0003ff8007ffc00f03e00f01e00f00f00000f00000f00001f00001e00003c0000f80",
"f000 f2 3c 001f00003e00007e0000f80001f00003e00007c0001f80001ffff01ffff01000000000000000000000003300000000000000000000000007ff800fff",
"f000 f3 3c c00fffe00e01e00e01e00001e00001e00001e00001e000ffc001ff8000ffe00001e00001e00001e00001e00001e00001e00e01e00e01e00fffe007ff",
"f000 f4 3c c000f80000000000000000000034000000000000000000000000000100000300000700000f00000f00001f00003f00007f00007f0000ff0001ef0003",
"f000 f5 3c cf0003cf00078f000f0f000fffe00fffe00fffe0000f00000f00000f00000f00000f00000000000000000000350000000000000000000000000fffc0",
"f000 f6 3c 0fffc00fffc00f00000f00000f00000f00000f00000f00000fff000fff800007c00003e00001e00001e00001e00001e00001e00e01e00e03c00fffc0",
"f000 f7 3c 07ff8000f8000000000000000000003600000000000000000000000000ffe007ffe007ffe00f00000f00000f00000f00000f00000f00000f00000fff",
"f000 f8 12 0032bb000005010000029106000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 f9 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 65 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 68 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 fa 3c 32bb00000701000019910600000c0200000500000000080000000200000fffc00fffe00f01e00f01e00f01e00f01e00f01e00f01e00f83e007ffc003",
"f000 fb 3c ff80007c00000000000000000000370000000000000000000000000fffe00fffe00fffe00001e00003c00003c00003c0000780000780000f80000f00",
"f000 fc 3c 000f00001e00001e00003e00003c00003c0000780000780000f80000f00000f00001e0000000000000000000003800000000000000000000000001ff",
"f000 fd 3c 0007ffc007ffc00f01e00f01e00f01e00f01e00f01e00f01e00f83c007ffc007ffc00f83e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00fff",
"f000 fe 3c e007ffc00078000000000000000000003900000000000000000000000001ff0003ff8007ffc00f83e00f01e00f01e00f01e00f01e00f01e00f01e00f",
"f000 ff 3c 01e00f81e007ffe003ffe00001e00001e00001e00001e00001e00003e00fffc00fff800ff8000000000000000000003a000000000000000000000000",
"f000 00 3c 000000000000000000000000000000000000000000007c00007c00007c00000000000000000000000000000000000000000000000000000000007c00",
"f000 01 3c 007c00007c00007c000000000000000000003b000000000000000000000000000000000000000000000000000000000000000000003c00003c00003c",
"f000 02 3c 00000000000000000000000000000000000000000000000000000000000000003c00003c00003c00003c00007c000078003c00000000000000000000",
"f000 03 12 0032bb000005010000199106000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 04 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 69 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 66 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 05 3c 32bb0000070100002f910600000c02000005000000000a000000020000000000000000000000000000000000e00003e0000fe0003f8001fe0007f000",
"f000 06 3c 1fc0001f800007f00001fc00007f00001fe00007e00000e00000200000000000000000000000000000000000000000003d0000000000000000000000",
"f000 07 3c 000000000000000000000000000000000000000000000000000fffe00fffe00000000000000000000000000fffe00fffe00fffe00000000000000000",
"f000 08 3c 000000000000000000000000000000000000003e0000000000000000000000000000000000000000000000000e00000f80000fe00003fc00007f0000",
"f000 09 3c 1fc00003f00003f0000fc0007f0001fc000ff0000fc0000f00000800000000000000000000000000000000000000000000003f000000000000000000",
"f000 0a 3c 00000007fe0007ff8007ffc00003e00001e00001e00001e00001e00003c00007c0000f80003e00007800007800007800007800000000000000000000",
"f000 0b 3c 00f80000f80000f80000f8000000000000000000004000000000000000000000000003ffc00fffe01e00f01c00701c00701c3f701cff701def701dcf",
"f000 0c 3c 701dcf701dcf701dcf701dcf701dcf701dcf701def701dff701cfff01c03e01c00001ffe000ffe0001fe000000000000000000004100000000000000",
"f000 0d 3c 0000001000003800003800003800007c00007c00007c0000fe0000fe0000ee0001ef0001cf0003c70003c78003878007ff8007ffc007ffc00f01c00f",
"f000 0e 12 0132bb000005010000309106000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 0f 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 6a 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 67 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 10 3c 32bb00000701000047910600000c02000005000000000c000000020000e00f01e01e01e01e00f01e0080000000000000000000420000000000000000",
"f000 11 3c 000000000ffe000fff800fffc00f03c00f03c00f03c00f03c00f03c00f03c00f07c00fff800fffc00f03e00f01e00f01e00f01e00f01e00f01e00f01",
"f000 12 3c e00f03e00fffc00fff800ff8000000000000000000004300000000000000000000000000ff8003ffc007ffe00f80e00f00000f00000f00000f00000f",
"f000 13 3c 00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00e00f81e007ffe003ffc000010000000000000000000044000000000000",
"f000 14 3c 0000000000000fff000fffc00fffc00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e0",
"f000 15 3c 0f01e00f03e00fffc00fff800ff800000000000000000000450000000000000000000000000fffc00fffc00f00000f00000f00000f00000f00000f00",
"f000 16 3c 000f00000fff800fff800fff800f00000f00000f00000f00000f00000f00000f00000f00000fffe00fffe00fffe00000000000000000004600000000",
"f000 17 3c 00000000000000000fffe00fffe00f00000f00000f00000f00000f00000f00000f00000f00000fffc00fffc00f00000f00000f00000f00000f00000f",
"f000 18 3c 00000f00000f00000f00000f00000f00000000000000000000004700000000000000000000000001ffc007ffc007ffc00f00000f00000f00000f0000",
"f000 19 12 0f32bb000005010000479106000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 1a 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 6b 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 68 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 1b 3c 32bb0000070100005d910600000c02000005000000000e00000002000000000f00000f00000f00000f3fc00f3fe00f01e00f00e00f00f00f00f00f00",
"f000 1c 3c f00f00f00f81e007ffe003ffe0002000000000000000000000480000000000000000000000000f01e00f01e00f01e00f01e00f01e00f01e00f01e00f",
"f000 1d 3c 01e00f01e00f01e00fffe00fffe00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e000000000000000000049000000",
"f000 1e 3c 00000000000000000003ff8003ff80007800007800007800007800007800007800007800007800007800007800007800007800007800007800007800",
"f000 1f 3c 00780000780000780003ff8003ff8003ff800000000000000000004a0000000000000000000000000001e00001e00001e00001e00001e00001e00001",
"f000 20 3c e00001e00001e00001e00001e00001e00001e00001e00001e00001e00001e00f01e00f03e00f83c007ffc003ff800078000000000000000000004b00",
"f000 21 3c 00000000000000000000000f01e00f03c00f07c00f07800f0f000f1f000f3e000f3c000f7c000ff8000ff0000ff0000ff8000ff8000ffc000f3e000f",
"f000 22 3c 1e000f0f000f0f800f07c00f03c00f01e00f01f00000000000000000004c0000000000000000000000000f00000f00000f00000f00000f00000f0000",
"f000 23 3c 0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000fffe00fffe00fffe0000000000000000000",
"f000 24 12 4d32bb0000050100005e9106000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 25 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 6c 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 69 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 26 3c 32bb00000701000075910600000c0200000500000000100000000200000000000000000000000000001f83f01fc3f01fc7f01fc7f01fc7f01fe7f01d",
"f000 27 3c eff01deff01deef01cfef01cfef01cfef01c7cf01c7cf01c7cf01c00f01c00f01c00f01c00f01c00f01c00f01c00f01c00f00000000000000000004e",
"f000 28 3c 0000000000000000000000001f80f01fc0f01fc0f01fe0f01fe0f01fe0f01ef0f01ef0f01ef0f01e78f01e78f01e3cf01e3cf01e3cf01e1ef01e1ef0",
"f000 29 3c 1e1ef01e0ff01e0ff01e0ff01e07f01e07f01e03f00000000000000000004f00000000000000000000000001ff0007ffc00fffe00f01e00f00f01f00",
"f000 2a 3c f01f00f01f00f01f00f01f00f01f00f01f00f01f00f01f00f01f00f01f00f01f00f00f00f00f01e00f01e00fffe003ff800038000000000000000000",
"f000 2b 3c 00500000000000000000000000000fff000fffc00fffe00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00fffe00fffc00fff000f00000f",
"f000 2c 3c 00000f00000f00000f00000f00000f00000f00000f00000000000000000000005100000000000000000000000001ff0007ffc00fc7e00f01e00f01e0",
"f000 2d 3c 0f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f0fe00f1fe00f0fe00f83e007ffe003fff00000f0000040000000",
"f000 2e 3c 000000520000000000000000000000000ffe000fff800fffc00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f03c00fffc00fff000f1f000f0f",
"f000 2f 12 0032bb000005010000759106000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 30 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 6d 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 6a 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 31 3c 32bb0000070100008c910600000c0200000500000000120000000200000f0f800f07800f07800f03c00f03c00f01e00f01e00f00f000000000000000",
"f000 32 3c 00005300000000000000000000000000ff8007ffe007ffe00f00e00f00e00f00000f00000f00000f00000f800007ff8003ffc00003e00001e00001e0",
"f000 33 3c 0001e00001e00001e01e01e01e03e01fffc00fff8001f800000000000000000000540000000000000000000000001ffff01ffff01ffff00078000078",
"f000 34 3c 000078000078000078000078000078000078000078000078000078000078000078000078000078000078000078000078000078000078000000000000",
"f000 35 3c 00000000550000000000000000000000000f01f00f01f00f01f00f01f00f01f00f01f00f01f00f01f00f01f00f01f00f01f00f01f00f01f00f01f00f",
"f000 36 3c 01f00f01f00f01f00f01f00f01e00f81e007ffe003ff80003800000000000000000000560000000000000000000000001e00f01e00f01e00f00f01e0",
"f000 37 3c 0f01e00f01c00783c00783c003878003c78003c78001cf0001ef0001ee0000fe0000fe00007c00007c00007800003800003800003000001000000000",
"f000 38 3c 000000000000570000000000000000000000001c00701e00701e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01e38f01e7cf01e7c",
"f000 39 3c f01efee01eeee00eeee00fefe00fcfe00fc7e00fc7e00f87e00f83e0000000000000000000580000000000000000000000001f01f00f01e00783e007",
"f000 3a 12 c332bb0000050100008c9106000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 3b 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 6e 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 6b 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 3c 3c 32bb000007010000a2910600000c020000050000000014000000020000c003c78003ef8001ef0000ff0000fe00007e00007c00007c00007e0000fe00",
"f000 3d 3c 00ff0001ef0003ef8003c7800783c00f83e00f01e01f01f01e00f0000000000000000000590000000000000000000000001e00f01f01f00f01e00783",
"f000 3e 3c c00783c003c78003c78001ef0001ff0000fe0000fc00007c000078000078000078000078000078000078000078000078000078000078000078000000",
"f000 3f 3c 000000000000005a0000000000000000000000000ffff00ffff00ffff00001e00003e00007c0000780000f00001f00001e00003c0000780000780000",
"f000 40 3c f00001e00003e00003c0000780000f00000f00001fffe01fffe01fffe00000000000000000005b00000003ff8003ff8003c00003c00003c00003c000",
"f000 41 3c 03c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c000",
"f000 42 3c 03c00003ff8003ff805c0000000f00000f00000f000007800007800003c00003c00001c00001e00001e00000f00000f000007800007800003800003c",
"f000 43 3c 00003c00001e00001e00000f00000f00000f000007800007800003c00003c00001c00001e00001e05d00000003ff8003ff8000078000078000078000",
"f000 44 3c 078000078000078000078000078000078000078000078000078000078000078000078000078000078000078000078000078000078000078000078000",
"f000 45 12 0732bb000005010000a39106000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 46 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 6f 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 6c 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 47 3c 32bb000007010000b9910600000c0200000500000000160000000200008000078003ff8003ff805e000000000000007c0000fe0000fe0001ef0001ef",
"f000 48 3c 0003c78003c7800783c00783c00783c00f01e00000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 49 3c 000000000000000000005f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 4a 3c 00000000000000000000000000000000000000000000000000000000003ffff83ffff83ffff80000006000000000000000000000f000007800003c00",
"f000 4b 3c 001e00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 4c 3c 0000000000000000000000006100000000000000000000000000000000000000000000000000000000000000000007fe0007ff000007800007800007",
"f000 4d 3c 8000078003ff8007ff800f87800f07800f07800f07800f07800fffe007ffe00078e00000000000000000006200000000000000000000000007800007",
"f000 4e 3c 800007800007800007800007800007800007ff8007ffc00783c00783c00783c00783c00783c00783c00783c00783c00783c00783c00783c007ffc007",
"f000 4f 3c ff8007f0000000000000000000006300000000000000000000000000000000000000000000000000000000000000000000ff8001ff8003c00003c000",
"f000 50 12 0332bb000005010000ba9106000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 51 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 70 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 6d 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 52 3c 32bb000007010000d1910600000c020000050000000018000000020000c00003c00003c00003c00003c00003c00003c00003c00003c00001ff8001ff",
"f000 53 3c 80000f80000000000000000000640000000000000000000000000003c00003c00003c00003c00003c00003c00003c003ffc007ffc00783c00783c007",
"f000 54 3c 03c00703c00703c00703c00703c00703c00703c00783c00783c007ffc003ffc00039c000000000000000000065000000000000000000000000000000",
"f000 55 3c 00000000000000000000000000000000000003ff0003ff800783c00783c00783c00783c007ffc007ffc007ffc007800007800007800007800003ff80",
"f000 56 3c 01ff80001f8000000000000000000066000000000000000000000000003fc0007fc000ffc000f00000f00000f00000f00007ffc007ffc000f00000f0",
"f000 57 3c 0000f00000f00000f00000f00000f00000f00000f00000f00000f00007ff0007ff0007ff000000000000000000006700000000000000000000000000",
"f000 58 3c 000000000000000000000000000000000000000001fff007fff00780f00f00f01e00f01e00f01e00f01e00f01e00f01e00f01e00f01f00f00f01f00f",
"f000 59 3c c3f007fff001fef00000f00000f00001e06800000000000000000000000007800007800007800007800007800007800007800007ff8007ffc00783c0",
"f000 5a 3c 0783c00783c00783c00783c00783c00783c00783c00783c00783c00783c00783c00783c00783c0000000000000000000690000000000000000000000",
"f000 5b 12 0032bb000005010000d19106000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 5c 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 71 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 6e 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 5d 3c 32bb000007010000e7910600000c02000005000000001a000000020000001e00003f00003f00001e0000000000000000000001fe0001fe00001e0000",
"f000 5e 3c 1e00001e00001e00001e00001e00001e00001e00001e00001e00001e0007fff807fff807fff80000000000000000006a000000000000000000000000",
"f000 5f 3c 000f80000f80000f8000000000000000000000000001ff0001ff00000700000700000700000700000700000700000700000700000700000700000700",
"f000 60 3c 000700000700000700000700000700000f006b000000000000000000000000078000078000078000078000078000078000078000078f80079f00079e",
"f000 61 3c 0007bc0007f80007f00007f00007f80007fc0007be00079e00079f00078f800787800787c00783e00000000000000000006c00000000000000000000",
"f000 62 3c 00000ff8000ff8000ff80000780000780000780000780000780000780000780000780000780000780000780000780000780000780000780000780000",
"f000 63 3c 7800007fe0003fe0000fe00000000000000000006d0000000000000000000000000000000000000000000000000000000000000000001fffe01fffe0",
"f000 64 3c 1e7cf01e38f01e38f01e38f01e38f01e38f01e38f01e38f01e38f01e38f01e38f01e38f01e38f01e38f00000000000000000006e0000000000000000",
"f000 65 3c 0000000000000000000000000000000000000000000000000007ff8007ffc00783c00783c00783c00783c00783c00783c00783c00783c00783c00783",
"f000 66 12 c032bb000005010000e89106000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 67 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 72 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 6f 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 68 3c 32bb000007010000ff910600000c02000005000000001c0000000200000783c00783c00783c00783c00000000000000000006f000000000000000000",
"f000 69 3c 00000000000000000000000000000000000000000000000003ff8007ffc00783c00703c00701c00f01c00f01c00f01c00f01c00f01c00f01c00703c0",
"f000 6a 3c 0783c007ffc003ff800038000000000000000000007000000000000000000000000000000000000000000000000000000000000000000007ff0007ff",
"f000 6b 3c 800787c00783c00783c00783c00783c00783c00783c00783c00783c00783c00783c007ffc007ff8007fe000780000780000780007100000000000000",
"f000 6c 3c 000000000000000000000000000000000000000000000000000001ffc003ffc00783c00783c00703c00703c00703c00703c00703c00703c00703c007",
"f000 6d 3c 03c00783c007ffc003ffc000ffc00003c00003c00003c07200000000000000000000000000000000000000000000000000000000000000000007ffc0",
"f000 6e 3c 07ffc000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00007fe0007fe0007fe00000000000000000000730000000000",
"f000 6f 3c 0000000000000000000000000000000000000000000000000000000001ff8003ff8003c00003c00003c00003c00003fe0001ff80003f800007800007",
"f000 70 3c 8000078000078003ff8003ff0003f0000000000000000000007400000000000000000000000000000000000000000000780000780000780000780007",
"f000 71 12 ff32bb000005010000ff9106000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 72 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 73 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 70 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 73 3c 32bb00000701000015920600000c02000005000000001e000000020000c007ffc0007800007800007800007800007800007800007800007800007800",
"f000 74 3c 007800007800007fc0003fc0000fc0000000000000000000750000000000000000000000000000000000000000000000000000000000000000000783",
"f000 75 3c c00783c00783c00783c00783c00783c00783c00783c00783c00783c00783c00783c00783c003ffc003ffc0003bc00000000000000000007600000000",
"f000 76 3c 00000000000000000000000000000000000000000000000000000000000f01e00f81e00783c00783c00783c003c78003c78003c78001ef0001ef0001",
"f000 77 3c ef0000fe0000fe0000fe00007c00007c0000000000000000000077000000000000000000000000000000000000000000000000000000000000000000",
"f000 78 3c 1e00f01e00f01e38f00e3ce00f3ce00f7de00f7de00f7de0077fc007ffc007efc007efc007efc003ef8003c78003c780000000000000000000780000",
"f000 79 3c 000000000000000000000000000000000000000000000000000000000000000783c003c78003e78001ef0000fe0000fe00007c00007c0000fc0000fe",
"f000 7a 3c 0001ef0001ef0003c7800787c00783c00f01e00000000000000000007900000000000000000000000000000000000000000000000000000000000000",
"f000 7b 3c 00000f01e00f81e00783c00783c007c3c003c38003c78001e78001e78001ef0000ef0000ff0000fe00007e00007e00007c00003c00003c000078007a",
"f000 7c 12 0032bb000005010000169206000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 7d 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 74 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 71 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 7e 3c 32bb0000070100002c920600000c02000005000000002000000002000000000000000000000000000000000000000000000000000000000000000000",
"f000 7f 3c 0003ffc003ffc00007c0000f80000f00001e00003e00007c0000780000f00001f00003e00003c00007ff8007ff8007ff800000000000000000007b00",
"f000 80 3c 0000003f00007f0000780000780000780000780000780000780000780000780000780000780000f80001f00001c00001f00000f80000780000780000",
"f000 81 3c 7800007800007800007800007800007800007800007800007f00003f007c000000003800003800003800003800003800003800003800003800003800",
"f000 82 3c 003800003800003800003800003800003800003800003800003800003800003800003800003800003800003800003800003800003800003800003800",
"f000 83 3c 7d00000001f80001fc00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00003c00001f00000700001f00003e00003c00003c",
"f000 84 3c 00003c00003c00003c00003c00003c00003c00003c00003c0001fc0001f8007e00000000000000000000000000000000000000000000000000000000",
"f000 85 3c 000000000000000000000000000000004003f9c007ffc0071f8004000000000000000000000000000000000000000000000000000000000000000000",
"f000 86 3c 0000b000000000000000000000000000fe0001ff0003c78003838003838003838003c78003ef8001ff00001000000000000000000000000000000000",
"f000 87 12 0032bb0000050100002d9206000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 88 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 75 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 72 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 89 3c 32bb00000701000044920600000c02000005000000002200000002000000000000000000000000000000000000000000000000000000000000000000",
"f000 8a 3c 0010260000000000000000000000fffffefffffefffffec0000ec0000ec0000ec0000ec0000ec0000ec0000ec0000ec0000ec0000ec0000ec0000ec0",
"f000 8b 3c 000ec0000ec0000ec0000ec0000ec0000ec0000ec0000efffffefffffefffffe90210000000000000000000000000000000000000000000000000000",
"f000 8c 3c 0000000100000300000700000700000e00001e00003ffff03ffff01e00000f0000070000030000010000010000000000000000000000000000000000",
"f000 8d 3c 00000091210000000000000000000000000000000000000000000000001000007c0000fe0003ff8007ffc00f39e00038000038000038000038000038",
"f000 8e 3c 000038000038000038000038000038000038000000000000000000000000000000009221000000000000000000000000000000000000000000000000",
"f000 8f 3c 00000000000002000003000003800003c00001c00000e03ffff03ffff00001e00003c000038000030000020000020000000000000000000000000000",
"f000 90 3c 000000000093210000000000000000000000000000000000000000000000003800003800003800003800003800003800003800003800003800003800",
"f000 91 3c 0038000fbbe007ff8001ff0000fe00003800001000000000000000000000000000000000940300000000000000000000000000000000000000000078",
"f000 92 12 0032bb000005010000449206000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 93 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 76 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 73 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 94 3c 32bb0000070100005b920600000c020000050000000024000000020000007c0000fc0000fe0001ee0001ef0003c78003c7800783c00783c00f01e01f",
"f000 95 3c 01e01e00f03e00f03c00787c007c78003c7ffffc7ffffc7ffffc000000000000000000212b0000000000000000000000000000003000007c0000fe00",
"f000 96 3c 03ef8007c7c00f83e03e00f83c00783800383800383800383800383800383800383800383c00f81f01f00f83e003ef8001ff0000fe00003800001000",
"f000 97 3c 000000000000c02500000000000000000000000000000000000000000000180000780000f80003f8000ff8003ff800fff801fff807fff81ffff80fff",
"f000 98 3c f807fff801fff8007ff8001ff8000ff80003f80000f8000038000008000000000000000000b625000000000000000000000000000000000000000010",
"f000 99 3c 00001c00001f00001fc0001fe0001ff8001ffe001fff801fffe01ffff01ffff01fffc01fff001ffc001ff8001fe0001f80001e00001c000010000000",
"f000 9a 3c 0000000000000000882500000000000000000000000fffe00fffe00fffe00fffe00fffe00fffe00fffe00fffe00fffe00fffe00fffe00fffe00fffe0",
"f000 9b 3c 0fffe00fffe00fffe00fffe00fffe00fffe00fffe00fffe00fffe00fffe0000000000000000000b22500000000000000000000000000000000000000",
"f000 9c 3c 00000000000000003800003800007c0000fe0000fe0001ff0003ff8003ff8007ffc00fffe00fffe01ffff03ffff83ffff87ffffcfffffe0000000000",
"f000 9d 12 0032bb0000050100005b9206000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 9e 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 77 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 74 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 9f 3c 32bb00000701000072920600000c020000050000000026000000020000000000000000000000bc250000000000000000000000000000000000000000",
"f000 a0 3c 0000000000007ffffc3ffff83ffff81ffff00fffe00fffe007ffc003ff8003ff8001ff0000fe0000fe00007c00003800003800001000000000000000",
"f000 a1 3c 000000000000000000a0250000000000000000000000000000000000000000fffffcfffffcfffffcfffffcfffffcfffffcfffffcfffffcfffffcffff",
"f000 a2 3c fcfffffcfffffcfffffcfffffcfffffcfffffcfffffcfffffcfffffc000004000000000000000000a1250000000000000000000000fffffefffffeff",
"f000 a3 3c fffec00006c00006c00006c00006c00006c00006c00006c00006c00006c00006c00006c00006c00006c00006c00006c00006c00006c00006c00006c0",
"f000 a4 3c 0006fffffefffffefffffe00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 a5 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 a6 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 a7 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 a8 12 0032bb000005010000729206000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 a9 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 78 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 75 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 aa 3c 32bb00000701000088920600004801000005000000002800003c01000000000000000000000000000000000000000000000000000000000000000000",
"f000 ab 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 ac 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 ad 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 ae 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 af 3c 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000032bb00000501000089920600010000",
"f000 b0 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 b1 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 79 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 76 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 b2 3c 32bb0000060100009a92060000190000000600000017001d005b0000007400000000000000552900000032bb0000070100009a920600000c02000006",
//                            the second 32 bb block seems to be the start of the small font? --^
"f000 b3 3c 000000000000000002000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
// ^- -                           ^^^^--- whose preamble finishes here
"f000 b4 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000210000000000000000000000000000000000",
"f000 b5 3c 000000000000000000000000000000000000000000000038000038000038000038000038000038000038000038000038000038000000000000000038",
"f000 b6 3c 000038000038000000000000002200000000000000000000000000000000000000000000000000000000000000000000000000000000ee0000ee0000",
"f000 b7 3c ee0000ee0000ee0000ee0000000000000000000000000000000000000000000000000000000000000000000023000000000000000000000000000000",
"f000 b8 3c 00000000000000000000000000000000000000000000000000ee0000ee0000ee0000ee0003ff8000ee0000ee0000ee0000ee0003ff8003ff8000ee00",
"f000 b9 3c 00ee0000ee0000ee000000000000002400000000000000000000000000000000000000000000000000000000000000000000000000380000380000ff",
"f000 ba 3c 8003ff8003b80003b80003b80003b80003ff0001ff80003b80003b80003b80003b8003ff8003fe000038000038002500000000000000000000000000",
"f000 bb 3c 000000000000000000000000000000000000000000000000000003e0c007f18006738006730007760007fc32bb0000050100009a9206000100000000",
"f001 bc 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 7a 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 77 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 bd 3c 32bb000007010000b2920600000c02000006000000000200000002000000001800003000007300007fc000dcc0019cc0031cc0061fc00e0200000000",
"f000 be 3c 0000002600000000000000000000000000000000000000000000000000000000000000000000000000000001fc00039e00038e00039c0001f80000f0",
"f000 bf 3c 0003f0000778e00e3ce00e1fc00e0fc00e0380078fe003fee00020200000000000002700000000000000000000000000000000000000000000000000",
"f000 c0 3c 000000000000000000000000000000380000380000380000380000380000380000000000000000000000000000000000000000000000000000000000",
"f000 c1 3c 000000000028000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f80003c0000f00001e000",
"f000 c2 3c 01c00003800003800003800003800003800003c00001c00000e000007800003f00000780290000000000000000000000000000000000000000000000",
"f000 c3 3c 0000000000000000000000000000000000000003e000007c00001e00000700000380000380000380000380000380000380000380000700000f00001e",
"f000 c4 3c 0000f80001c0002a00000000000000000000000000000000000000000000000000000000000000000000000000380001bf0000fe0000380003ff0000",
"f000 c5 3c 380000fc0001ff000008000000000000000000000000000000000000000000000000000000002b000000000000000000000000000000000000000000",
"f000 c6 12 0032bb000005010000b29206000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 c7 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 7b 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 78 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 c8 3c 32bb000007010000c9920600000c02000006000000000400000002000000000000000000000000000000000000000000000000000000000000000038",
"f000 c9 3c 0000380000380003ff8003ff800038000038000038000038000000000000000000000000002c00000000000000000000000000000000000000000000",
"f000 ca 3c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003c0000",
"f000 cb 3c 3c000038000038002d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 cc 3c 00000000000000000003ff8003ff800000000000000000000000000000000000000000000000002e0000000000000000000000000000000000000000",
"f000 cd 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000038000038",
"f000 ce 3c 000038000000000000002f0000000000000000000000000000000000000000000000000000000000000000000000e00001c00003c000038000070000",
"f000 cf 3c 0700000e00001c00001c0000380000780000700000e00000e00001c0000380000380000700000f000030000000000000000000000000000000000000",
"f000 d0 3c 000000000000000000000000000000000000000000007c0001ff0003c780038380038780038f80039f8003bb8003f38003e38003c38003838003c780",
"f000 d1 12 0132bb000005010000c99206000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 d2 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 7c 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 79 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 d3 3c 32bb000007010000df920600000c020000060000000006000000020000ff000010000000000000003100000000000000000000000000000000000000",
"f000 d4 3c 0000000000000000000000000000000000000000003c00007c0000fc0000bc00003c00003c00003c00003c00003c00003c00003c00003c00003c0001",
"f000 d5 3c ff0001ff0000000000000032000000000000000000000000000000000000000000000000000000000000000000000000000000007c0001ff00038780",
"f000 d6 3c 0381c00001c00003c0000780000f00001e00003c0000f80001e00007c00007ffc0040000000000000000330000000000000000000000000000000000",
"f000 d7 3c 0000000000000000000000000000000000000000000001ff0003ff8003038000038000038000038000ff00007f800003800003c00003c00003800303",
"f000 d8 3c 8003ff800078000000000000003400000000000000000000000000000000000000000000000000000000000000000000000000000000020000060000",
"f000 d9 3c 0e00001e00003e00007e0000fe0000ee0001ce00038e0007ffc0000e00000e00000e00000e0000000000000035000000000000000000000000000000",
"f000 da 3c 00000000000000000000000000000000000000000000000003ff8003ff8003800003800003800003800003ff00000f80000380000380000380070380",
"f000 db 3c 03078003ff000078000000000000003600000000000000000000000000000000000000000000000000000000000000000000000000000000ff8003ff",
"f000 dc 12 8032bb000005010000e09206000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 dd 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 7d 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 7a 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 de 3c 32bb000007010000f7920600000c02000006000000000800000002000003800003800003800003800003800003ff0003838003838003838003838003",
"f000 df 3c 838001ff000038000000000000003700000000000000000000000000000000000000000000000000000000000000000000000000000003ff8003ff80",
"f000 e0 3c 000380000780000700000f00000e00001e00001c00001c0000380000380000700000700000f000000000000000380000000000000000000000000000",
"f000 e1 3c 0000000000000000000000000000000000000000000000000000fe0003ff8003838003838003838003838003ff8003ff000383800783800783800783",
"f000 e2 3c 8003838003ff800038000000000000003900000000000000000000000000000000000000000000000000000000000000000000000000000000fe0001",
"f000 e3 3c ff0003838003838003838003838003838003c38001ff8000038000038000038000078003ff0003f8000000000000003a000000000000000000000000",
"f000 e4 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000003800003800000000000000000000000000000000",
"f000 e5 3c 0000000038000038000038000000000000003b0000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 e6 3c 00000000000000000000000000003c00003c00000000000000000000000000000000000000003c00003c000038000038003c00000000000000000000",
"f000 e7 12 0032bb000005010000f79206000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 e8 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 7e 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 7b 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 e9 3c 32bb0000070100000d930600000c02000006000000000a00000002000000000000000000000000000000000000000000000000000000000000000000",
"f000 ea 3c 000000000000000180000780003f0001f80007c00003e000007c00001f800007800000800000000000000000000000003d0000000000000000000000",
"f000 eb 3c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000003ff8000000000000000000003ff8003ff",
"f000 ec 3c 800000000000000000000000000000000000003e00000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 ed 3c 000000000000000003000003e00001f800003f000007c0000f80007e0003f00003c0000200000000000000000000000000003f000000000000000000",
"f000 ee 3c 00000000000000000000000000000000000000000000000000000000000003fe0003ff00000380000380000380000780000f00003c00007000007000",
"f000 ef 3c 000000000000007800007800007800000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 f0 3c 0001ff0007ffc00701c00701c007ffc007efc007efc007efc007efc007efc007ffc00737c007000007fc0000fc000000000000004100000000000000",
"f000 f1 3c 0000000000000000000000000000000000000000000000000000000000001000001000003800003800007c00007c0000fc0000ee0000ee0001c70001",
"f000 f2 12 ff32bb0000050100000e9306000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 f3 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 7f 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 7c 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 f4 3c 32bb00000701000024930600000c02000006000000000c0000000200000003ff800383800383800703c0070100000000000000420000000000000000",
"f000 f5 3c 0000000000000000000000000000000000000000000000000000000000000003fc0003ff0003878003878003878003878003ff0003ff000383800383",
"f000 f6 3c 8003838003838003838003ff8003f8000000000000004300000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 f7 3c 000000ff0001ff8003818003800003800003800003800003800003800003800003800003800003c3c001ff8000020000000000000044000000000000",
"f000 f8 3c 00000000000000000000000000000000000000000000000000000000000000000003fe0003ff80038380038380038380038380038380038380038380",
"f000 f9 3c 03838003838003838003838003ff0003f800000000000000450000000000000000000000000000000000000000000000000000000000000000000000",
"f000 fa 3c 0000000003ff0003ff0003800003800003800003800003ff0003ff0003800003800003800003800003800003ff8003ff800000000000004600000000",
"f000 fb 3c 000000000000000000000000000000000000000000000000000000000000000000000003ff8003ff8003800003800003800003800003800003ff0003",
"f000 fc 3c 800003800003800003800003800003800003800000000000000047000000000000000000000000000000000000000000000000000000000000000000",
"f000 fd 12 0032bb000005010000259306000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 fe 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 80 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 7d 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 ff 3c 32bb0000070100003c930600000c02000006000000000e000000020000000000000000ff0003ff0003800003800003800003800003800003bf8003bf",
"f000 00 3c 800383c00381c00381c00383c001ff80003f000000000000004800000000000000000000000000000000000000000000000000000000000000000000",
"f000 01 3c 000000000003838003838003838003838003838003838003ff8003ff8003838003838003838003838003838003838003838000000000000049000000",
"f000 02 3c 00000000000000000000000000000000000000000000000000000000000000000000000000fe0000fe00003800003800003800003800003800003800",
"f000 03 3c 00380000380000380000380000380000fe0000fe000000000000004a0000000000000000000000000000000000000000000000000000000000000000",
"f000 04 3c 0000000000000000038000038000038000038000038000038000038000038000038000038000038003838003878001ff000070000000000000004b00",
"f000 05 3c 0000000000000000000000000000000000000000000000000000000000000000000000000000038380038780038f00039e0003bc0003b80003f00003",
"f000 06 3c f00003f80003fc00039c00038e000387000387800383c00000000000004c000000000000000000000000000000000000000000000000000000000000",
"f000 07 3c 00000000000000000003800003800003800003800003800003800003800003800003800003800003800003800003800003ff8003ff80000000000000",
"f000 08 12 4d32bb0000050100003c9306000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 09 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 81 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 7e 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 0a 3c 32bb00000701000052930600000c02000006000000001000000002000000000000000000000000000000000000000000000000000000000000000000",
"f000 0b 3c 000000000000000007c7c007c7c007e7c007efc007efc007efc0077dc0077dc0077dc00739c00701c00701c00701c00701c00701c00000000000004e",
"f000 0c 3c 00000000000000000000000000000000000000000000000000000000000000000000000000000007c1c007e1c007e1c007e1c00771c00771c00779c0",
"f000 0d 3c 0739c0073dc0071dc0071dc0070fc0070fc0070fc00707c00000000000004f0000000000000000000000000000000000000000000000000000000000",
"f000 0e 3c 0000000000000000000000fe0003ff800383800783c00783c00783c00783c00783c00783c00783c00783c00783c003838003ff800038000000000000",
"f000 0f 3c 005000000000000000000000000000000000000000000000000000000000000000000000000000000003fe0003ff8003838003838003838003838003",
"f000 10 3c 838003ff8003ff0003800003800003800003800003800003800000000000000051000000000000000000000000000000000000000000000000000000",
"f000 11 3c 00000000000000000000000000000001ff000383800783800783c00783c00783c00783c00783c00783c00783c0079fc0038f8003ff8000ffc0000080",
"f000 12 3c 0000005200000000000000000000000000000000000000000000000000000000000000000000000000000003fe0003ff800383800383800383800383",
"f000 13 12 8032bb000005010000529306000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 14 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 82 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 7f 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 15 3c 32bb00000701000069930600000c02000006000000001200000002000003838003ff0003fc00038e00038f000387000387800383800381c000000000",
"f000 16 3c 00005300000000000000000000000000000000000000000000000000000000000000000000000000000000ff0003ff80038380038000038000038000",
"f000 17 3c 03fe0001ff8000038000038000038003038007838003ff0000f800000000000000540000000000000000000000000000000000000000000000000000",
"f000 18 3c 0000000000000000000000000007ffc007ffc00038000038000038000038000038000038000038000038000038000038000038000038000038000000",
"f000 19 3c 00000000550000000000000000000000000000000000000000000000000000000000000000000000000000000783c00783c00783c00783c00783c007",
"f000 1a 3c 83c00783c00783c00783c00783c00783c00783c003838003ff8000380000000000000056000000000000000000000000000000000000000000000000",
"f000 1b 3c 0000000000000000000000000000000701c00701c003838003838003c70001c70001cf0000ee0000ee00007c00007c00003800003800003000001000",
"f000 1c 3c 000000000000570000000000000000000000000000000000000000000000000000000000000000000000000000000701c00701c00701c00701c00701",
"f000 1d 3c c00701c00701c00739c0077dc0077dc0076fc007efc007cf8003c78003c7800000000000005800000000000000000000000000000000000000000000",
"f000 1e 12 0032bb0000050100006a9306000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 1f 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 83 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 80 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 20 3c 32bb00000701000080930600000c020000060000000014000000020000000000000000000000000000000000000783c003c38001c70001ef0000fe00",
"f000 21 3c 007c00003c00003c00007c0000fe0000ef0001c70003c7800783c00701c0000000000000590000000000000000000000000000000000000000000000",
"f000 22 3c 000000000000000000000000000000000701c003838003c78001c70000ee0000fe00007c000038000038000038000038000038000038000038000038",
"f000 23 3c 000000000000005a00000000000000000000000000000000000000000000000000000000000000000000000000000003ffc003ffc000038000078000",
"f000 24 3c 0f00001e00001c0000380000700000e00001c00003c00007800007ffc007ffc00000000000005b000000000000000000000000000000000000000000",
"f000 25 3c 00000000000000000000000001ff0001ff0001c00001c00001c00001c00001c00001c00001c00001c00001c00001c00001c00001c00001c00001c000",
"f000 26 3c 01c00001c00001ff005c00000000000000000000000000000000000000000000000000000000000000000007800003800003800001c00001c00000e0",
"f000 27 3c 0000e000007000007000003800003800001c00001c00000e00000e000007000007000003800003805d00000000000000000000000000000000000000",
"f000 28 3c 000000000000000000000000000001ff0001ff0000070000070000070000070000070000070000070000070000070000070000070000070000070000",
"f000 29 12 0732bb000005010000819306000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 2a 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 84 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 81 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 2b 3c 32bb00000701000098930600000c0200000600000000160000000200000000070000070001ff005e0000000000000000000000000000000000000000",
"f000 2c 3c 00000000000000000000000000000000007c00007e0000ee0001ef0001c70003c7800383800000000000000000000000000000000000000000000000",
"f000 2d 3c 000000000000000000005f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 2e 3c 00000000000000000000000000000000000000000000000000000000000000000fffe00fffe000000060000000000000000000000000000000000000",
"f000 2f 3c 000000000000000000000000000000000000000000007800003c00001e00000000000000000000000000000000000000000000000000000000000000",
"f000 30 3c 000000000000000000000000610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 31 3c 0000000001f80001fe0000070000070000ff0003ff0003870003870003870003ff800079800000000000006200000000000000000000000000000000",
"f000 32 3c 000000000000000000000000000000000000000000000003800003800003800003800003fc0003ff0003c78003838003838003838003838003838003",
"f000 33 3c 878003ff0003f00000000000000063000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 34 12 0032bb000005010000989306000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 35 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 85 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 82 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 36 3c 32bb000007010000af930600000c0200000600000000180000000200000000000000003f0000ff0001c00001c00001c00001c00001c00001c00001e0",
"f000 37 3c 0000ff00000f000000000000006400000000000000000000000000000000000000000000000000000000000000000000000000000000038000038000",
"f000 38 3c 0380000380007f8001ff8003c38003838003838003838003838003838003c78001ff80001b8000000000000065000000000000000000000000000000",
"f000 39 3c 000000000000000000000000000000000000000000000000000000000000000000000000007c0001ff0001c70003c78003c78003ff8003c00003c000",
"f000 3a 3c 01c00001ff00001f0000000000000066000000000000000000000000000000000000000000000000000000000000000000000000000000003f00007f",
"f000 3b 3c 0000700000700001ff0001ff0000700000700000700000700000700000700000700001fe0001fe000000000000006700000000000000000000000000",
"f000 3c 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000001ffc003c1c00781c00701c00701c00701c007",
"f000 3d 3c 01c00783c003c7c000ffc00001c00003c068000000000000000000000000000000000000000000000000000000000000000000000000000000038000",
"f000 3e 3c 03800003800003800003fc0003ff0003c780038380038380038380038380038380038380038380038380000000000000690000000000000000000000",
"f000 3f 12 0032bb000005010000af9306000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 40 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 86 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 83 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 41 3c 32bb000007010000c5930600000c02000006000000001a000000020000000000000000000000000000000000000000000000000000000000001c0000",
"f000 42 3c 1e00001c0000000000fc0000fc00001c00001c00001c00001c00001c00001c00001c0001ffe001ffe00000000000006a000000000000000000000000",
"f000 43 3c 000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000fe00000e00000e00000e00000e00000e00",
"f000 44 3c 000e00000e00000e00000e00000e00000e006b00000000000000000000000000000000000000000000000000000000000000000000000000000003c0",
"f000 45 3c 0003c00003c00003c00003c70003de0003fc0003f80003f00003f80003fc0003de0003ce0003cf0003c7800000000000006c00000000000000000000",
"f000 46 3c 000000000000000000000000000000000000000000000000000000000003f80003f80000380000380000380000380000380000380000380000380000",
"f000 47 3c 3800003800003800003f80000f800000000000006d000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 48 3c 00000000000000000000000007e70007ffc00739c00739c00739c00739c00739c00739c00739c00739c00739c00000000000006e0000000000000000",
"f000 49 3c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000003fc0003ff0003c7800383800383800383",
"f000 4a 12 8032bb000005010000c59306000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 4b 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 87 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 84 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 4c 3c 32bb000007010000dc930600000c02000006000000001c0000000200000383800383800383800383800383800000000000006f000000000000000000",
"f000 4d 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000007c0001ff0003c780038380038380038380",
"f000 4e 3c 03838003838003c78001ff00001000000000000000700000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 4f 3c 0000000000000000000000000000000003ff0003c78003838003838003838003838003838003878003ff0003fe000380000380007100000000000000",
"f000 50 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ff8003c38003838003838003",
"f000 51 3c 838003838003838003838001ff8000ff8000038000038072000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 52 3c 00000000000000000000000000000001ff0001ff0000f00000f00000f00000f00000f00000f00000f00001fe0001fe00000000000000730000000000",
"f000 53 3c 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007e0001fe0001c00001c00001f8",
"f000 54 3c 0000fe0000070000070000070001fe0001f0000000000000007400000000000000000000000000000000000000000000000000000000000000000000",
"f000 55 12 0032bb000005010000dd9306000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 56 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 88 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 85 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 57 3c 32bb000007010000f3930600000c02000006000000001e0000000200000000000000000000000000700000700001ff0001ff00007000007000007000",
"f000 58 3c 007000007000007000007000003f00000f00000000000000750000000000000000000000000000000000000000000000000000000000000000000000",
"f000 59 3c 0000000000000000000000000000000003c78003c78003c78003c78003c78003c78003c78003c78001c78001ff800013800000000000007600000000",
"f000 5a 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003838003838003c78001c70001",
"f000 5b 3c c70000ee0000ee0000fe00007c00007c00007c0000000000000077000000000000000000000000000000000000000000000000000000000000000000",
"f000 5c 3c 0000000000000000000000000000000000000701c00701c00739c003bb8003bf8003ff8003ff8001ef0001ef0001ef0001ef00000000000000780000",
"f000 5d 3c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003c78001c70000ee0000fc",
"f000 5e 3c 00007c00003800007c0000ee0001ef0003c7800383800000000000007900000000000000000000000000000000000000000000000000000000000000",
"f000 5f 3c 000000000000000000000000000000000000000000000003838003c38001c70001c70000ef0000ee0000fe00007e00007c00003c000038000038007a",
"f000 60 12 0032bb000005010000f49306000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 89 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 61 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 86 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 62 3c 32bb0000070100000b940600000c02000006000000002000000002000000000000000000000000000000000000000000000000000000000000000000",
"f000 63 3c 0000000000000000000000000000000000000001ff0001ff00000f00001e00001c0000380000700000f00001e00001ff0001ff000000000000007b00",
"f000 64 3c 0000000000000000000000000000000000000000000000000000000000000000001e00003e0000380000380000380000380000380000380000700000",
"f000 65 3c e00000f000003800003800003800003800003800003800003800003e007c000000000000000000000000000000000000000000000000000000000000",
"f000 66 3c 000000003800003800003800003800003800003800003800003800003800003800003800003800003800003800003800003800003800003800003800",
"f000 67 3c 7d00000000000000000000000000000000000000000000000000000000000000000000f00000f800003800003800003800003800003800003800001c",
"f000 68 3c 00000e00001e0000380000380000380000380000380000380000380000f8007e00000000000000000000000000000000000000000000000000000000",
"f000 69 3c 000000000000000000000000000000000000000000000000000000000000000001fb0001ff0001000000000000000000000000000000000000000000",
"f000 6a 3c 0000b0000000000000000000000000000000000000000000000000000000000000000000000000000000007c0000fe0001c70001c70001c70000fe00",
"f000 6b 12 0032bb0000050100000c9406000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 6c 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 8a 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 87 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 6d 3c 32bb00000701000022940600000c02000006000000002200000002000010000000000000000000000000000000000000000000000000000000000000",
"f000 6e 3c 00102600000000000000000000000000000000000000000000000000000000000000000000000000000000003ffff838003838003838003838003838",
"f000 6f 3c 00383800383800383800383800383800383800383800383800383ffff83ffff890210000000000000000000000000000000000000000000000000000",
"f000 70 3c 0000000000000000000000000000000000000000000000000080000180000380000700000fffc0070000038000018000008000000000000000000000",
"f000 71 3c 00000091210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003800007c0001ff",
"f000 72 3c 0003bb800038000038000038000038000038000038000038000000000000000000009221000000000000000000000000000000000000000000000000",
"f000 73 3c 00000000000000000000000000000000000000000000000000000004000007000007800fffc00fffc000038000070000060000040000000000000000",
"f000 74 3c 000000000093210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003800003800",
"f000 75 3c 00380000380000380000380000380003ff8000fe00007c00001000000000000000000000940300000000000000000000000000000000000000000000",
"f000 76 12 0032bb000005010000229406000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 77 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 8b 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 88 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 78 3c 32bb00000701000039940600000c020000060000000024000000020000000000000000000000000000000000000000000000003800007c0000fc0000",
"f000 79 3c ee0001c70001c7000383800783c00701c00f01e01e00f01ffff01ffff0000000000000212b0000000000000000000000000000000000000000000000",
"f000 7a 3c 000000000000000000000000000000000000001000007c0001ef0003c7800f01c00e00c00e00c00e00c00e00c00e00c00783c003c78000fe00007c00",
"f000 7b 3c 001000000000c02500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400001c00007",
"f000 7c 3c c0001fc000ffc003ffc007ffc001ffc0007fc0001fc00007c00001c0000000000000000000b625000000000000000000000000000000000000000000",
"f000 7d 3c 000000000000000000000000000000000000000000000004000007000007e00007f80007fe0007ff8007ffc007ff0007fc0007f00007c00007000004",
"f000 7e 3c 00000000000000008825000000000000000000000000000000000000000000000000000000000000000000000000000003ff8003ff8003ff8003ff80",
"f000 7f 3c 03ff8003ff8003ff8003ff8003ff8003ff8003ff8003ff8003ff8003ff8003ff80000000000000b22500000000000000000000000000000000000000",
"f000 80 3c 00000000000000000000000000000000000000000000000000000000001000003800007c00007c0000fe0001ff0003ff8007ffc007ffc00fffe01fff",
"f000 81 12 f032bb000005010000399406000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 82 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 8c 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 89 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 83 3c 32bb0000070100004f940600000c020000060000000026000000020000000000000000000000bc250000000000000000000000000000000000000000",
"f000 84 3c 0000000000000000000000000000000000000000000000000000001ffff00fffe007ffc003ff8003ff8001ff0000fe00007c00007c00003800001000",
"f000 85 3c 000000000000000000a02500000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ffff01fff",
"f000 86 3c f01ffff01ffff01ffff01ffff01ffff01ffff01ffff01ffff01ffff01ffff0000010000000000000a125000000000000000000000000000000000000",
"f000 87 3c 00000000000000000000000000000000000000000000003ffff838003838003838003838003838003838003838003838003838003838003838003838",
"f000 88 3c 00383800383ffff83ffff800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 89 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 8a 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 8b 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 8c 12 0032bb000005010000509406000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 8d 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 8d 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 8a 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 8e 3c 32bb00000701000067940600004801000006000000002800003c01000000000000000000000000000000000000000000000000000000000000000000",
"f000 8f 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 90 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 91 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 92 3c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 93 3c 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000032bb00000501000067940600010000",
"f000 94 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 95 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 8e 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 8b 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"0232 bb 00 00034901ff0000000000",
"f000 96 11 32bb00001e01000078940600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 97 2a 32bb000018010000799406000008000000340025000e00180032bb000005010000799406000100000000000000000000000000000000000000000000",
"f001 98 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 8f 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 8c 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 99 3c 32bb00001901000080940600000e000000010005000000020000000000000032bb00001901000080940600000e000000010006000000030000000000",
"f000 9a 3c 000032bb00001901000080940600000e0000000200000000ff040000000000000032bb00001901000080940600000e000000020000a5ffff05000000",
"f000 9b 3c 0000000032bb00001901000080940600000e0000000200ffffffff060000000000000032bb00001901000080940600000e0000000200ffff00ff0700",
"f000 9c 3c 00000000000032bb00001901000080940600000e00000002003dff00ff080000000000000032bb00001901000080940600000e0000000200ff63ffff",
"f000 9d 3c 090000000000000032bb00001901000080940600000e00000002000000ffff0a0000000000000032bb00001901000080940600000e000000020000ff",
"f000 9e 3c ffff0b0000000000000032bb00001901000080940600000e0000000200425c61ff0c0000000000000032bb00001901000080940600000e0000000200",
"f000 9f 3c 777777ff0d0000000000000032bb00001901000080940600000e00000002005e7379ff0e0000000000000032bb00001901000080940600000e000000",
"f000 a0 3c 0300000000ff0f0000000000000032bb00001901000081940600000e000000030000a5ffff100000000000000032bb00001901000081940600000e00",
"f000 a1 3c 00000300ffffffff110000000000000032bb00001901000081940600000e0000000300ffff00ff120000000000000032bb0000190100008194060000",
"f000 a2 3c 0e00000003003dff00ff130000000000000032bb00001901000081940600000e0000000300ff63ffff140000000000000032bb000019010000819406",
"f000 a3 3c 00000e00000003000000ffff150000000000000032bb00001901000081940600000e000000030000ffffff160000000000000032bb00001901000081",
"f000 a4 3c 940600000e0000000300425c61ff170000000000000032bb00001901000081940600000e0000000300777777ff180000000000000032bb0000190100",
"f000 a5 3c 0081940600000e00000003005e7379ff190000000000000032bb00001901000081940600000e0000000400000000001a0000000000000032bb000019",
"f000 a6 3c 01000081940600000e0000000400010000001b0000000000000032bb00001901000081940600000e0000000400020000001c0000000000000032bb00",
"f000 a7 0e 000501000081940600010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 a8 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 8d 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 90 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 a9 34 32bb00001a010000a094060000010000000232bb00001c010000a0940600000000000032bb000005010000a094060001000000000000000000000000",
"f001 8e 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 aa 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 91 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 ab 11 32bb000005010000a9940600010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 ac 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 8f 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 92 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f000 ad 3c 32bb000012010000ad9406000004000000ff00000032bb000013010000ad9406000004000000ff00000032bb000010010000ad940600000800000000",
"f000 ae 29 0000008002e00132bb000003010000ad940600000000000032bb000005010000ad940600010000000000000000000000000000000000000000000000",
"f001 af 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 93 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
"f001 90 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",



                "0232bb0000034900cc0000000000", // <-- set button backlight to 0xcc out of 0xff
                "0232bb0000034901ff0000000000", // <-- set display backlight to full
            };
            foreach(var packet in packets) {
                SendStringPacket(packet.Replace(" ", ""));
            }
        }

        /// <inheritdoc/>
        public void RefreshDisplay(bool skipDuplicateCheck = false)
        {
            lock(_OutputLock) {
                var duplicateCheckString = Screen.BuildDuplicateCheckString();
                if(skipDuplicateCheck || _DisplayDuplicateCheckString != duplicateCheckString) {
                    InitialiseDisplayPacket();
                    for(var rowIdx = 0;rowIdx < Screen.Rows.Length;++rowIdx) {
                        var row = Screen.Rows[rowIdx];
                        for(var cellIdx = 0;cellIdx < row.Cells.Length;++cellIdx) {
                            var cell = row.Cells[cellIdx];
                            AddCellToDisplayPacket(
                                cell,
                                isFirstCell: rowIdx == 0 && cellIdx == 0,
                                isLastCell:  rowIdx + 1 == Screen.Rows.Length && cellIdx + 1 == row.Cells.Length
                            );
                        }
                    }
                    PadAndSendDisplayPacket();
                    _DisplayDuplicateCheckString = duplicateCheckString;

                    if(_ProcessingPauseMilliseconds > 0) {
                        // If we send packets too quickly then the device can freak out. I don't see any errors coming
                        // back in WireShark, it just doesn't update the screen properly. This forces a pause so that
                        // a set of very fast updates won't corrupt the display.
                        Thread.Sleep(_ProcessingPauseMilliseconds);
                    }
                }
            }
        }

        public void RefreshLeds(bool skipDuplicateCheck = false)
        {
            if(skipDuplicateCheck || !(_PreviousLeds?.Equals(Leds) ?? false)) {
                void sendBright(double? previous, double current, byte indicatorCode)
                {
                    if(previous != current) {
                        SendLedOrBrightnessPacket(indicatorCode, (byte)(0xff * current));
                    }
                }
                void sendLight(bool? previous, bool current, byte indicatorCode)
                {
                    if(previous != current) {
                        SendLedOrBrightnessPacket(indicatorCode, current ? (byte)1 : (byte)0);
                    }
                }

                sendBright(_PreviousLeds?.Brightness,   Leds.Brightness,    0x02);
                sendLight(_PreviousLeds?.Fail,          Leds.Fail,          0x08);
                sendLight(_PreviousLeds?.Fm,            Leds.Fm,            0x09);
                sendLight(_PreviousLeds?.Mcdu,          Leds.Mcdu,          0x0a);
                sendLight(_PreviousLeds?.Menu,          Leds.Menu,          0x0b);
                sendLight(_PreviousLeds?.Fm1,           Leds.Fm1,           0x0c);
                sendLight(_PreviousLeds?.Ind,           Leds.Ind,           0x0d);
                sendLight(_PreviousLeds?.Rdy,           Leds.Rdy,           0x0e);
                sendLight(_PreviousLeds?.Line,          Leds.Line,          0x0f);
                sendLight(_PreviousLeds?.Fm2,           Leds.Fm2,           0x10);

                if(_PreviousLeds == null) {
                    _PreviousLeds = new Leds();
                }
                _PreviousLeds.CopyFrom(Leds);
            }
        }

        private void InitialiseDisplayPacket()
        {
            _DisplayPacket[0] = 0xF2;
            _DisplayPacketOffset = 1;
        }

        private void AddCellToDisplayPacket(Cell cell, bool isFirstCell, bool isLastCell)
        {
            _DisplayCharacterBuffer[0] = cell.Character;
            var utf8Bytes = Encoding.UTF8.GetBytes(_DisplayCharacterBuffer);
            AddColourAndBytesToDisplayPacket(cell.Colour, cell.Small, isFirstCell, isLastCell);
            for(var chIdx = 0;chIdx < utf8Bytes.Length;++chIdx) {
                AddToDisplayPacketSendWhenFull(utf8Bytes[chIdx]);
            }
        }

        private void AddColourAndBytesToDisplayPacket(Colour colour, bool isSmallFont, bool isFirstCell, bool isLastCell)
        {
            (var b1, var b2) = colour.ToUsbColourAndFontCode(isSmallFont);
            if(isFirstCell) {
                b1 += 1;
            } else if(isLastCell) {
                b1 += 2;
            }
            AddToDisplayPacketSendWhenFull(b1);
            AddToDisplayPacketSendWhenFull(b2);
        }

        private void AddToDisplayPacketSendWhenFull(byte value)
        {
            _DisplayPacket[_DisplayPacketOffset++] = value;
            if(_DisplayPacketOffset == _DisplayPacket.Length) {
                SendPacket(_DisplayPacket);
                InitialiseDisplayPacket();
            }
        }

        private void PadAndSendDisplayPacket()
        {
            if(_DisplayPacketOffset > 1) {
                for(var idx = _DisplayPacketOffset;idx < _DisplayPacket.Length;++idx) {
                    _DisplayPacket[idx] = 0;
                }
                SendPacket(_DisplayPacket);
                InitialiseDisplayPacket();
            }
        }

        private void SendStringPacket(string packet)
        {
            var bytes = new byte[packet.Length / 2];
            for(var idx = 0;idx < packet.Length / 2;++idx) {
                bytes[idx] = (byte)Convert.ToInt32(packet.Substring(idx * 2, 2), 16);
            }
            SendPacket(bytes);
        }

        private byte[] _LedOrBrightnessPacket = new byte[] {
            0x02, 0x32, 0xbb, 0x00, 0x00, 0x03, 0x49,
            0x00, 0x00,     // <-- these two change with each call
            0x00, 0x00, 0x00, 0x00, 0x00
        };

        internal void SendLedOrBrightnessPacket(byte indicatorCode, byte value)
        {
            lock(_OutputLock) {
                const int indicatorOffset = 7;
                _LedOrBrightnessPacket[indicatorOffset] = indicatorCode;
                _LedOrBrightnessPacket[indicatorOffset + 1] = value;
                SendPacket(_LedOrBrightnessPacket);
            }
        }

        private void SendPacket(byte[] bytes)
        {
            lock(_OutputLock) {
                var stream = _HidStream;
                try {
                    stream?.Write(bytes);
                } catch(IOException) {
                    // This can happen when the device is disconnected mid-write
                    ;
                }
            }
        }

        private void InputLoop(CancellationToken cancellationToken)
        {
            var readBuffer = new byte[InputReport01.PacketLength];

            while(!cancellationToken.IsCancellationRequested) {
                try {
                    var stream = _HidStream;
                    if(stream?.CanRead ?? false) {
                        ClearHidStreamBuffer(stream);
                        stream.ReadTimeout = 1000;
                        try {
                            var bytesRead = stream.Read(readBuffer, 0, readBuffer.Length);
                            if (bytesRead > 0) {
                                if(readBuffer[0] == 1 && bytesRead >= InputReport01.PacketLength) {
                                    ProcessInputReport1(readBuffer, bytesRead);
                                }
                            }
                        } catch(TimeoutException) {
                            // ugh
                        }
                    }
                } catch(IOException) {
                    // These will happen when the device is disconnected. Under Windows we can look for the Win32
                    // exception and tell for sure, but that won't fly on other platforms. For now I'm going to
                    // assume that any IO exception during the input loop is indicative of the device being
                    // disconnected.
                    //
                    // There is a strong argument for raising the disconnected event here. However, we're also
                    // listening to HidSharp's device change event and raising from there, so we risk a reentrant
                    // raise if we do. Also if the event handler disposes of this MCDU on a disconnect then the
                    // dispose will block waiting for us to finish, but we would be blocking waiting on the event
                    // handler... the wait would timeout eventually but it wouldn't be very nice.
                }
                Thread.Sleep(1);
            }
        }

        private readonly byte[] _ClearBuffer = new byte[InputReport01.PacketLength];
        private void ClearHidStreamBuffer(HidStream stream)
        {
            stream.ReadTimeout = 1;
            try {
                while(stream.Read(_ClearBuffer, 0, _ClearBuffer.Length) > 0) {
                    ;
                }
            } catch(TimeoutException) {
                // ugh
            }
        }

        private void ProcessInputReport1(byte[] readBuffer, int bytesRead)
        {
            _InputReport01_Current.CopyFrom(readBuffer, 0, bytesRead);
            var digest = _InputReport01_Current.ToDigest();
            if(   digest.Item1 != _PreviousInputReport01Digest.Item1
               || digest.Item2 != _PreviousInputReport01Digest.Item2
               || digest.Item3 != _PreviousInputReport01Digest.Item3
            ) {
                try {
                    foreach(Key key in Enum.GetValues(typeof(Key))) {
                        var pressed = _InputReport01_Current.IsKeyPressed(key);
                        var wasPressed = _InputReport01_Previous.IsKeyPressed(key);
                        if(pressed != wasPressed) {
                            if(pressed) {
                                OnKeyDown(() => new KeyEventArgs(key, pressed));
                            } else {
                                OnKeyUp(() => new KeyEventArgs(key, pressed));
                            }
                        }
                    }
                } catch {
                    // Swallow the exception for now - ultimately we want the events raised on a different thread
                }
                _InputReport01_Previous.CopyFrom(_InputReport01_Current);
                _PreviousInputReport01Digest = digest;
            }
        }

        private void HidSharpDeviceList_Changed(object sender, DeviceListChangedEventArgs e)
        {
            var mcduPresent = HidSharp
                .DeviceList
                .Local
                .GetHidDevices()
                .Any(device => device.DevicePath == _HidDevice.DevicePath);
            if(!mcduPresent) {
                OnDisconnected();
            }
        }
    }
}
